<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Our Secret Space ‚ù§Ô∏è</title>
  <style>
    /* --- DESIGN & COLORS --- */
    body { margin: 0; background: #ece5dd; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; height: 100vh; display: flex; flex-direction: column; }
    
    /* Login Screen */
    #lock { position: fixed; inset: 0; background: #fff; z-index: 99; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s; }
    input.pass { padding: 15px; font-size: 18px; border-radius: 30px; border: 1px solid #ccc; text-align: center; margin-bottom: 15px; width: 80%; max-width: 300px; outline: none; }
    button.btn { padding: 12px 30px; background: #075e54; color: white; border: none; border-radius: 30px; font-size: 16px; cursor: pointer; font-weight: bold; }
    
    /* Chat Screen */
    #chat-wrap { display: none; flex-direction: column; height: 100%; max-width: 600px; margin: 0 auto; background: #e5ddd5; position: relative; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
    
    header { background: #075e54; color: white; padding: 15px 20px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; z-index: 10; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
    
    #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 8px; scroll-behavior: smooth; }
    
    /* Bubble Styles */
    .msg { padding: 8px 12px; border-radius: 8px; max-width: 75%; font-size: 15px; position: relative; word-wrap: break-word; box-shadow: 0 1px 1px rgba(0,0,0,0.1); line-height: 1.4; }
    .msg.me { align-self: flex-end; background: #dcf8c6; border-top-right-radius: 0; }
    .msg.her { align-self: flex-start; background: #fff; border-top-left-radius: 0; }
    .time { font-size: 10px; color: #999; text-align: right; margin-top: 4px; display: block; }

    /* Input Area */
    #input-area { display: flex; padding: 10px; background: #f0f0f0; gap: 10px; align-items: center; }
    #txt { flex: 1; padding: 12px 15px; border-radius: 25px; border: none; outline: none; font-size: 15px; background: white; }
    .send-btn { background: #075e54; color: white; width: 40px; height: 40px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }

  </style>
</head>
<body>

  <!-- LOCK SCREEN -->
  <div id="lock">
    <h2 style="color:#444; margin-bottom:20px;">üîí Restricted Access</h2>
    <p style="color:#666; margin-bottom:20px; font-size: 14px;">Hint: What is my favorite name for you?</p>
    <input type="password" id="pass" class="pass" placeholder="Enter nickname..." autocomplete="off">
    <button class="btn" onclick="login()">Enter</button>
    <p id="error" style="color:red; margin-top:10px; opacity:0; font-size:14px;">Wrong password!</p>
  </div>

  <!-- CHAT AREA -->
  <div id="chat-wrap">
    <header>
      <div style="display:flex; align-items:center; gap:10px;">
        <div style="width:35px; height:35px; background:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#075e54; font-size:14px;">‚ù§Ô∏è</div>
        <span>Us</span>
      </div>
      <button onclick="location.reload()" style="background:transparent; border:none; color:rgba(255,255,255,0.8); cursor:pointer; font-size:12px;">Refresh</button>
    </header>
    
    <div id="messages">
      <!-- Messages appear here -->
    </div>
    
    <div id="input-area">
      <input type="text" id="txt" placeholder="Type a message..." autocomplete="off">
      <button class="send-btn" onclick="send()">‚û§</button>
    </div>
  </div>

  <!-- FIREBASE ENGINE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    // --- YOUR SPECIFIC CONFIGURATION ---
    const firebaseConfig = {
      apiKey: "AIzaSyDznEmz6rxBJ_2QAgWIoEzWPBpM5QvocRQ",
      authDomain: "our-space-cbc39.firebaseapp.com",
      projectId: "our-space-cbc39",
      storageBucket: "our-space-cbc39.firebasestorage.app",
      messagingSenderId: "930162638208",
      appId: "1:930162638208:web:72cac87408d931efe01565"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    // --- SETTINGS ---
    const PASSWORD = "babu"; // The password is "babu" (lowercase)
    
    let user = "Her"; // Default user is Her

    // Login Function
    window.login = () => {
      const p = document.getElementById('pass').value.toLowerCase().trim();
      const lock = document.getElementById('lock');
      
      if(p === PASSWORD) {
        // Animation to hide lock screen
        lock.style.opacity = '0';
        setTimeout(() => {
          lock.style.display = 'none';
          document.getElementById('chat-wrap').style.display = 'flex';
          scrollToBottom();
        }, 500);
        
        // Identity Check (Only asks once per session)
        if(confirm("Are you Ishan?\n\nClick OK for Yes.\nClick Cancel for Her.")) {
          user = "Ishan";
        }
        
        loadChat();
      } else {
        const err = document.getElementById('error');
        err.style.opacity = '1';
        setTimeout(() => err.style.opacity = '0', 2000);
      }
    };

    // Send Function
    window.send = async () => {
      const txt = document.getElementById('txt');
      const textVal = txt.value.trim();
      
      if(textVal) {
        try {
          await addDoc(collection(db, "chats"), {
            text: textVal,
            sender: user,
            time: serverTimestamp()
          });
          txt.value = "";
          txt.focus();
        } catch(e) {
          console.error(e);
          alert("Message failed to send. Please check your internet or Firebase 'Test Mode'.");
        }
      }
    };

    // Load Chat Function
    function loadChat() {
      const q = query(collection(db, "chats"), orderBy("time", "asc"));
      
      onSnapshot(q, (snap) => {
        const div = document.getElementById('messages');
        div.innerHTML = ""; // Clear current messages
        
        snap.forEach(doc => {
          const d = doc.data();
          if(!d.time) return; // Skip pending writes
          
          const isMe = d.sender === user;
          const date = d.time.toDate();
          const tStr = date.getHours() + ":" + String(date.getMinutes()).padStart(2,'0');
          
          div.innerHTML += `
            <div class="msg ${isMe ? 'me' : 'her'}">
              ${d.text}
              <span class="time">${tStr}</span>
            </div>`;
        });
        scrollToBottom();
      });
    }

    function scrollToBottom() {
      const div = document.getElementById('messages');
      div.scrollTop = div.scrollHeight;
    }

    // Enter Key Listeners
    document.getElementById('pass').addEventListener('keydown', (e) => {
      if(e.key === 'Enter') login();
    });
    document.getElementById('txt').addEventListener('keydown', (e) => {
      if(e.key === 'Enter') send();
    });
  </script>
</body>
</html>
